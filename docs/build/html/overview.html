
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Overview &#8212; Seldonian Engine pre-release documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Getting Started" href="getting_started.html" />
    <link rel="prev" title="Seldonian Engine documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<p>This document provides an overview of how <a class="reference external" href="https://seldonian.cs.umass.edu/Tutorials/">Seldonian algorithms</a> (SAs) are implemented using this library. For a detailed description of what SAs are, see the <a class="reference external" href="https://seldonian.cs.umass.edu/">Seldonian Machine Learning Toolkit homepage</a>.</p>
<p>The most important piece of the Seldonian Engine API is the <a class="reference internal" href="_autosummary/seldonian.seldonian_algorithm.SeldonianAlgorithm.html#seldonian.seldonian_algorithm.SeldonianAlgorithm" title="seldonian.seldonian_algorithm.SeldonianAlgorithm"><code class="xref py py-class docutils literal notranslate"><span class="pre">SeldonianAlgorithm</span></code></a> class. One can run a Seldonian algorithm using a single API call on this class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">seldonian.seldonian_algorithm</span> <span class="kn">import</span> <span class="n">SeldonianAlgorithm</span>
<span class="kn">from</span> <span class="nn">seldonian.utils.io_utils</span> <span class="kn">import</span> <span class="n">load_pickle</span>
<span class="c1"># here, the spec object is loaded from a file</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">load_pickle</span><span class="p">(</span><span class="s1">&#39;spec.pkl&#39;</span><span class="p">)</span>
<span class="n">SA</span> <span class="o">=</span> <span class="n">SeldonianAlgorithm</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<span class="n">SA</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>In this overview, we will go over what is in the <code class="code docutils literal notranslate"><span class="pre">spec</span></code> object and how to create it. We will also cover what <code class="code docutils literal notranslate"><span class="pre">SA.run()</span></code> actually does.</p>
<p>At the broadest scope, SAs consist of three parts: the interface, candidate selection, and the safety test. Below are the main components of the API that you will interact with within each of these parts.</p>
<p><strong>Note</strong>: The Engine supports supervised learning and reinforcement learning Seldonian algorithms. Where we could, we unified the code to work for both <a class="reference external" href="https://seldonian.cs.umass.edu/Tutorials/glossary/#regime">regimes</a>. However, you may notice a pattern in the API where there is a regime-independent base class from which two child classes inherit, one for each of the two regimes.</p>
<section id="interface">
<h2>Interface<a class="headerlink" href="#interface" title="Permalink to this headline">¶</a></h2>
<p>The interface is a general concept for how the user provides inputs to the SA (for a full  conceptual description, see <a class="reference external" href="https://seldonian.cs.umass.edu/overview/#framework">the Seldonian Toolkit Overview</a>). In the interface, the user provides (at minimum):</p>
<ul class="simple">
<li><p>the data</p></li>
<li><p>the metadata</p></li>
<li><p>the Behavioral constraints they want the SA to enforce.</p></li>
</ul>
<p>The interface outputs a <a class="reference internal" href="#spec-object">Spec object</a>, which consists of a complete specification used to run the seldonian algorithm.</p>
<p><strong>Note</strong>: The Engine library is not an interface. In general, it is up to a developer to design the interface for their specific application. We provide some example interfaces as part of the Seldonian Toolkit: a <a class="reference external" href="https://github.com/seldonian-toolkit/Engine/blob/main/interface/command_line_interface.py">command line interface</a> and a <a class="reference external" href="https://seldonian-toolkit.github.io/GUI">graphical user interface</a>.</p>
<section id="spec-object">
<h3>Spec object<a class="headerlink" href="#spec-object" title="Permalink to this headline">¶</a></h3>
<p>The “spec” object (short for specification object) contains all of the inputs needed to run the Seldonian algorithm, the most important of which are:</p>
<ul class="simple">
<li><p>the dataset</p></li>
<li><p>the underlying machine learning model</p></li>
<li><p>the behavioral constraints</p></li>
</ul>
<p>Each of these is represented by an object in the Engine API.</p>
<p>The <a class="reference internal" href="_autosummary/seldonian.spec.html#module-seldonian.spec" title="seldonian.spec"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spec</span></code></a> module contains the classes used to define spec objects. For the supervised learning regime, the <a class="reference internal" href="_autosummary/seldonian.spec.SupervisedSpec.html#seldonian.spec.SupervisedSpec" title="seldonian.spec.SupervisedSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupervisedSpec</span></code></a> class is used, and for the reinforcement learning regime the <a class="reference internal" href="_autosummary/seldonian.spec.RLSpec.html#seldonian.spec.RLSpec" title="seldonian.spec.RLSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">RLSpec</span></code></a> class is used.</p>
</section>
<section id="dataset-object">
<h3>Dataset object<a class="headerlink" href="#dataset-object" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="_autosummary/seldonian.dataset.html#module-seldonian.dataset" title="seldonian.dataset"><code class="xref py py-mod docutils literal notranslate"><span class="pre">dataset</span></code></a> module contains the <a class="reference internal" href="_autosummary/seldonian.dataset.SupervisedDataSet.html#seldonian.dataset.SupervisedDataSet" title="seldonian.dataset.SupervisedDataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupervisedDataSet</span></code></a> (supervised learning) and the <a class="reference internal" href="_autosummary/seldonian.dataset.RLDataSet.html#seldonian.dataset.RLDataSet" title="seldonian.dataset.RLDataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">RLDataSet</span></code></a> (reinforcement learning) classes. These objects contain the data points as well as metadata. These objects can be constructed manually, but we also provide a <a class="reference internal" href="_autosummary/seldonian.dataset.DataSetLoader.html#seldonian.dataset.DataSetLoader" title="seldonian.dataset.DataSetLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataSetLoader</span></code></a> class containing several convenience methods for loading data from files or arrays into the dataset objects.</p>
<p>For example, one can create a <a class="reference internal" href="_autosummary/seldonian.dataset.SupervisedDataSet.html#seldonian.dataset.SupervisedDataSet" title="seldonian.dataset.SupervisedDataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupervisedDataSet</span></code></a> from a data file and metadata file using the <a class="reference internal" href="_autosummary/seldonian.dataset.DataSetLoader.html#seldonian.dataset.DataSetLoader.load_supervised_dataset" title="seldonian.dataset.DataSetLoader.load_supervised_dataset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_supervised_dataset()</span></code></a> method. The data file that you provide to this method via the <code class="code docutils literal notranslate"><span class="pre">filename</span></code> parameter must consist of rows of numbers that are comma-separated and have no header. Categorical columns must be numerically encoded. For example, the file format might look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">622.6</span><span class="p">,</span><span class="mf">491.56</span><span class="p">,</span><span class="mf">439.93</span><span class="p">,</span><span class="mf">707.64</span><span class="p">,</span><span class="mf">663.65</span><span class="p">,</span><span class="mf">557.09</span><span class="p">,</span><span class="mf">711.37</span><span class="p">,</span><span class="mf">731.31</span><span class="p">,</span><span class="mf">509.8</span><span class="p">,</span><span class="mf">1.33333</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">538.0</span><span class="p">,</span><span class="mf">490.58</span><span class="p">,</span><span class="mf">406.59</span><span class="p">,</span><span class="mf">529.05</span><span class="p">,</span><span class="mf">532.28</span><span class="p">,</span><span class="mf">447.23</span><span class="p">,</span><span class="mf">527.58</span><span class="p">,</span><span class="mf">379.14</span><span class="p">,</span><span class="mf">488.64</span><span class="p">,</span><span class="mf">2.98333</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">455.18</span><span class="p">,</span><span class="mf">440.0</span><span class="p">,</span><span class="mf">570.86</span><span class="p">,</span><span class="mf">417.54</span><span class="p">,</span><span class="mf">453.53</span><span class="p">,</span><span class="mf">425.87</span><span class="p">,</span><span class="mf">475.63</span><span class="p">,</span><span class="mf">476.11</span><span class="p">,</span><span class="mf">407.15</span><span class="p">,</span><span class="mf">1.97333</span>
<span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">756.91</span><span class="p">,</span><span class="mf">679.62</span><span class="p">,</span><span class="mf">531.28</span><span class="p">,</span><span class="mf">583.63</span><span class="p">,</span><span class="mf">534.42</span><span class="p">,</span><span class="mf">521.4</span><span class="p">,</span><span class="mf">592.41</span><span class="p">,</span><span class="mf">783.76</span><span class="p">,</span><span class="mf">588.26</span><span class="p">,</span><span class="mf">2.53333</span>
<span class="o">...</span>
</pre></div>
</div>
<p>where each row represents a different sample and each column is a feature or a label. This file should include <em>all</em> of the data you have, i.e., the data before partitioning into train, test, validation splits. The Engine will partition your data internally. The column names are intentionally excluded from this file and are provided in a separate metadata file, via the <code class="code docutils literal notranslate"><span class="pre">metadata_filename</span></code> parameter.</p>
<p>The metadata file must be a JSON-formatted file containing several required <code class="docutils literal notranslate"><span class="pre">key:value</span></code> pairs depending on the regime of your problem. For supervised learning, the required keys are:</p>
<ul class="simple">
<li><p>“regime”, which is set to ‘supervised_learning’ in this case</p></li>
<li><p>“sub_regime”, which is either ‘classification’ or ‘regression’</p></li>
<li><p>“columns”, a list of all of the column names in your data file</p></li>
<li><p>“label_column”, the column that you are trying to predict</p></li>
<li><p>“sensitive_columns”, a list of the column names for the <a class="reference external" href="https://seldonian.cs.umass.edu/Tutorials/glossary/#sensitive_attributes">sensitive attributes</a> in your dataset</p></li>
</ul>
<p>For reinforcement learning, the required keys are:</p>
<ul class="simple">
<li><p>“regime”, which is set to ‘reinforcement_learning’ in this case</p></li>
<li><p>“columns”, a list of the column names in your data file</p></li>
<li><p>“RL_module_name”, the name of the module within <a class="reference internal" href="_autosummary/seldonian.RL.environments.html#module-seldonian.RL.environments" title="seldonian.RL.environments"><code class="xref py py-mod docutils literal notranslate"><span class="pre">RL.environments</span></code></a> containing the RL environment class you want to use</p></li>
<li><p>“RL_class_name”, the name of the class representing your environment inside the module you specified via the “RL_module_name” key</p></li>
</ul>
</section>
<section id="model-object">
<h3>Model object<a class="headerlink" href="#model-object" title="Permalink to this headline">¶</a></h3>
<p>The biggest split between supervised and reinforcement learning in the Engine API is in how the underlying machine learning model is represented. Supervised learning models are represented as classes in the module: <a class="reference internal" href="_autosummary/seldonian.models.models.html#module-seldonian.models.models" title="seldonian.models.models"><code class="xref py py-mod docutils literal notranslate"><span class="pre">models.models</span></code></a>. The base class for classification (regression) is: <a class="reference internal" href="_autosummary/seldonian.models.models.ClassificationModel.html#seldonian.models.models.ClassificationModel" title="seldonian.models.models.ClassificationModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClassificationModel</span></code></a> (<a class="reference internal" href="_autosummary/seldonian.models.models.RegressionModel.html#seldonian.models.models.RegressionModel" title="seldonian.models.models.RegressionModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">RegressionModel</span></code></a>). Any supervised learning model must inherit from either of these classes or one of their child classes. Some useful classes have already been created for running the tutorials, such as <a class="reference internal" href="_autosummary/seldonian.models.models.LinearRegressionModel.html#seldonian.models.models.LinearRegressionModel" title="seldonian.models.models.LinearRegressionModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">LinearRegressionModel</span></code></a> and <a class="reference internal" href="_autosummary/seldonian.models.models.LogisticRegressionModel.html#seldonian.models.models.LogisticRegressionModel" title="seldonian.models.models.LogisticRegressionModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogisticRegressionModel</span></code></a>. These classes essentially wrap scikitlearn’s model classes, for example, their <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html">LinearRegression</a> model.</p>
<p>Unless you are writing your own model, you will likely only need to know which of these models best fits your application. You may also want to choose from the primary objective functions, which are written as methods of the class. The primary objective function is one of the inputs to the spec object, though a default will be chosen if you do not explicitly pass one to the spec object.</p>
<p>The reinforcement learning model is represented by the <a class="reference internal" href="_autosummary/seldonian.RL.RL_model.RL_model.html#seldonian.RL.RL_model.RL_model" title="seldonian.RL.RL_model.RL_model"><code class="xref py py-class docutils literal notranslate"><span class="pre">RL_model</span></code></a> class. It is composed of an <a class="reference internal" href="_autosummary/seldonian.RL.environments.Environment.Environment.html#seldonian.RL.environments.Environment.Environment" title="seldonian.RL.environments.Environment.Environment"><code class="xref py py-class docutils literal notranslate"><span class="pre">Environment</span></code></a> class and an :py:class`.Agent` class, two things which supervised learning models do not have. All of these classes are found within modules of the larger <a class="reference internal" href="_autosummary/seldonian.RL.html#module-seldonian.RL" title="seldonian.RL"><code class="xref py py-mod docutils literal notranslate"><span class="pre">seldonian.RL</span></code></a> module.</p>
</section>
<section id="behavioral-constraints">
<h3>Behavioral constraints<a class="headerlink" href="#behavioral-constraints" title="Permalink to this headline">¶</a></h3>
<p>In the <a class="reference external" href="https://seldonian.cs.umass.edu/overview.html#algorithm">definition of a Seldonian algorithm</a>, <a class="reference external" href="https://seldonian.cs.umass.edu/Tutorials/glossary/#behavioral_constraints">behavioral constraints</a>, <span class="math notranslate nohighlight">\((g_i,{\delta}_i)_{i=1}^n\)</span> are of a set of constraint functions, <span class="math notranslate nohighlight">\(g_i\)</span>, and confidence levels, <span class="math notranslate nohighlight">\({\delta}_i\)</span>. Constraint functions need not be provided to the interface directly, but are often built by the engine from <em>constraint strings</em> provided by the user.</p>
<section id="constraint-strings">
<h4>Constraint strings<a class="headerlink" href="#constraint-strings" title="Permalink to this headline">¶</a></h4>
<p>Constraint strings contain the mathematical definition of the constraint functions, <span class="math notranslate nohighlight">\(g_i\)</span>. These strings are written as Python strings and support five different types of sub-strings.</p>
<ol class="arabic simple">
<li><p>The following math operators:</p></li>
</ol>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">+</span></code>, <code class="code docutils literal notranslate"><span class="pre">-</span></code>, <code class="code docutils literal notranslate"><span class="pre">*</span></code>, <code class="code docutils literal notranslate"><span class="pre">/</span></code></p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>These four native Python math functions:</p></li>
</ol>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">min()</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">max()</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">abs()</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">exp()</span></code></p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>Constants. These can be integers or floats, such as “4” or “0.239”.</p></li>
<li><p>Custom strings that trigger a call to a custom function. There are a set of special strings we call “measure functions” that correspond to statistical functions. For example, if <code class="code docutils literal notranslate"><span class="pre">Mean_Squared_Error</span></code> appears in a constraint string, the mean squared error will be calculated internally. Measure functions are specific to the machine learning regime. For a full list of currently supported measure functions, see: <a class="reference internal" href="_autosummary/seldonian.parse_tree.operators.html#module-seldonian.parse_tree.operators" title="seldonian.parse_tree.operators"><code class="xref py py-mod docutils literal notranslate"><span class="pre">parse_tree.operators</span></code></a>. We left open the possibility that developers will want to define their own measure functions by adding to the current list. Measure functions are defined to estimate the confidence bounds on the mean value of a quantity. It is possible developers will want to bound something other than the mean, or do it in a way that differs from how we implemented bounds in the Engine. They would do this by creating their own custom base nodes. We wrote the <a class="reference external" href="https://seldonian.cs.umass.edu/Tutorials/tutorials/custom_base_node_tutorial">custom base node tutorial</a> to instruct new users how to create their own measure functions as well as custom base nodes.</p></li>
<li><p>The inequality strings “&lt;=” or “&gt;=”. These are optional. Recall from <a class="reference external" href="https://seldonian.cs.umass.edu/overview.html#algorithm">the definition of a Seldonian algorithm</a> that we want <span class="math notranslate nohighlight">\(g_i{\leq}0\)</span> to be satisfied. However, it can be cumbersome to write all of your constraint strings with a “&lt;= 0” at the end. For convenience, we support constraint strings that both include and exclude the inequality symbols. For example, the four expressions will all be interpreted identically by the engine:</p></li>
</ol>
<ul class="simple">
<li><p>“Mean_Squared_Error &lt;= 4.0”</p></li>
<li><p>“Mean_Squared_Error - 4.0 &lt;= 0”</p></li>
<li><p>“Mean_Squared_Error - 4.0”</p></li>
<li><p>“4.0 &gt;= Mean_Squared_Error”</p></li>
</ul>
<p>Constraint strings with more than one inequality string or with “&gt;”, “&lt;”, or “=” by themselves are not supported and will result in an error when the Engine tries to parse the constraint string.</p>
<p>Here are a few examples of basic constraint strings and their plain English interpretation:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">Mean_Squared_Error</span> <span class="pre">-</span> <span class="pre">2.0</span></code>: “Ensure that the mean squared error is less than or equal to 2.0”. Here, <code class="code docutils literal notranslate"><span class="pre">Mean_Squared_Error</span></code> is a special measure function for supervised regression problems.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">0.88</span> <span class="pre">&lt;=</span> <span class="pre">TPR</span></code>: “Ensure that the True Positive Rate (TPR) is greater than or equal to 0.88”. Here, <code class="code docutils literal notranslate"><span class="pre">TPR</span></code> is a measure function for supervised classification problems.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">J_pi_new</span> <span class="pre">&gt;=</span> <span class="pre">0.5</span></code>: “Ensure that the performance of the new policy (<code class="code docutils literal notranslate"><span class="pre">J_pi_new</span></code>) is greater than or equal to 0.5”. Here, <code class="code docutils literal notranslate"><span class="pre">J_pi_new</span></code> is a measure function for reinforcement learning problems.</p></li>
</ul>
<p>These basic constraint strings cover a number of use cases. However, they do not use information about the sensitive attributes (columns) in the dataset, which commonly appear in fairness definitions. The Engine supports a specification for filtering the data used to calculate the bound on the quantity defined by the measure function over one or more sensitive attributes. This is only supported for supervised learning datasets. The specification for doing this is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">measure_function</span> <span class="o">|</span> <span class="p">[</span><span class="n">ATR1</span><span class="p">,</span><span class="n">ATR2</span><span class="p">,</span><span class="o">...</span><span class="p">])</span>
</pre></div>
</div>
<p>where <code class="code docutils literal notranslate"><span class="pre">measure_function</span></code> is a placeholder for the actual measure function in use and <code class="code docutils literal notranslate"><span class="pre">[ATR1,ATR2,...]</span></code> is a placeholder list of attributes (column names) from the dataset. The parentheses surrounding the statement are required in all cases.</p>
<p>Let’s say that an example dataset has four sensitive attributes: <code class="code docutils literal notranslate"><span class="pre">[M,F,R1,R2]</span></code>, standing for “male”, “female”, “race class 1”, “race class 2”).  The following constraint strings are examples of valid uses of measure functions subject to sensitive attributes.</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">abs((PR</span> <span class="pre">|</span> <span class="pre">[M])</span> <span class="pre">-</span> <span class="pre">(PR</span> <span class="pre">|</span> <span class="pre">[F]))</span> <span class="pre">&lt;=</span> <span class="pre">0.15</span></code>: “Ensure that the absolute difference between the positive rate (the meaning of the measure function “PR”) for males (M) and the positive rate for females (F) is less than or equal to 0.15”. This constraint is called demographic parity (with a tolerance of 15%). Here, <code class="code docutils literal notranslate"><span class="pre">M</span></code> and <code class="code docutils literal notranslate"><span class="pre">F</span></code> must be columns of the dataset, and specified both in the <code class="code docutils literal notranslate"><span class="pre">columns</span></code> key and the <code class="code docutils literal notranslate"><span class="pre">sensitive_columns</span></code> key in the <cite>Metadata file. We also see the use of a native Python function, :code:`abs()</cite>, in this constraint string.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">0.8</span> <span class="pre">-</span> <span class="pre">min((PR</span> <span class="pre">|</span> <span class="pre">[M])/(PR</span> <span class="pre">|</span> <span class="pre">[F]),(PR</span> <span class="pre">|</span> <span class="pre">[F])/(PR</span> <span class="pre">|</span> <span class="pre">[M]))</span></code>: “Ensure that ratio of the positive rate for males (M) to the positive rate for females (F) or the inverse ratio is at least 0.8.” This constraint is called disparate impact (with a tolerance of 0.8). We see the use of <code class="code docutils literal notranslate"><span class="pre">min()</span></code>, another native Python function in this constraint string.</p></li>
</ul>
<p>It is permitted to use more than one attribute for a given measure function. For example:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">(FPR</span> <span class="pre">|</span> <span class="pre">[F,R1])</span> <span class="pre">&lt;=</span> <span class="pre">0.2</span></code>: “Ensure that the false positive rate (FPR) for females (F) belonging to race class 1 (R1) is less than or equal to 0.2.</p></li>
</ul>
<p>Note that the constraint strings only make up part of the behavioral constraints. The user must also specify the values of <span class="math notranslate nohighlight">\({\delta}\)</span> for each provided constraint string. The Engine bundles the list of behavioral constraints into <a class="reference internal" href="_autosummary/seldonian.parse_tree.parse_tree.ParseTree.html#seldonian.parse_tree.parse_tree.ParseTree" title="seldonian.parse_tree.parse_tree.ParseTree"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParseTree</span></code></a> objects. The list of parse trees is one of the required inputs to the <a class="reference internal" href="#spec-object">Spec object</a>.</p>
</section>
</section>
</section>
<section id="candidate-selection">
<span id="id2"></span><h2>Candidate Selection<a class="headerlink" href="#candidate-selection" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="_autosummary/seldonian.seldonian_algorithm.SeldonianAlgorithm.html#seldonian.seldonian_algorithm.SeldonianAlgorithm" title="seldonian.seldonian_algorithm.SeldonianAlgorithm"><code class="xref py py-class docutils literal notranslate"><span class="pre">seldonian_algorithm.SeldonianAlgorithm</span></code></a> is a central class in the API that handles both candidate selection and the safety test. This class has a method <a class="reference internal" href="_autosummary/seldonian.seldonian_algorithm.SeldonianAlgorithm.html#seldonian.seldonian_algorithm.SeldonianAlgorithm.run" title="seldonian.seldonian_algorithm.SeldonianAlgorithm.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">seldonian_algorithm.SeldonianAlgorithm.run()</span></code></a> that runs candidate selection and then the safety test using the outputs of candidate selection. The inputs to candidate selection are assembled from the spec object provided to the <a class="reference internal" href="_autosummary/seldonian.seldonian_algorithm.SeldonianAlgorithm.html#seldonian.seldonian_algorithm.SeldonianAlgorithm" title="seldonian.seldonian_algorithm.SeldonianAlgorithm"><code class="xref py py-class docutils literal notranslate"><span class="pre">seldonian_algorithm.SeldonianAlgorithm</span></code></a> object.</p>
<p>There are currently two supported optimization techniques for candidate selection:</p>
<ol class="arabic simple">
<li><p>Black box optimization with a barrier function. The barrier, which is shaped like the upper bound functions, is added to the cost function when any of the constraints are violated. This forces solutions toward the feasible set.</p></li>
<li><p>Gradient descent on a <a class="reference external" href="https://en.wikipedia.org/wiki/Lagrange_multiplier#:~:text=In%20mathematical%20optimization%2C%20the%20method,chosen%20values%20of%20the%20variables).">Lagrangian</a>:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[{\mathcal{L(\mathbf{\theta,\lambda})}} = f(\mathbf{\theta}) + {\sum}_i^{n} {\lambda_i} g_i(\mathbf{\theta})\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{\theta}\)</span> is the vector of model weights, <span class="math notranslate nohighlight">\(f(\mathbf{\theta})\)</span> is the primary objective function, <span class="math notranslate nohighlight">\(g_i(\mathbf{\theta})\)</span> is the ith constraint function of <span class="math notranslate nohighlight">\(n\)</span> constraints, and <span class="math notranslate nohighlight">\(\mathbf{\lambda}\)</span> is a vector of Lagrange multipliers, such that <span class="math notranslate nohighlight">\({\lambda_i}\)</span> is the Lagrange multiplier for the ith constraint.</p>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Karush%E2%80%93Kuhn%E2%80%93Tucker_conditions">KKT</a> Theorem states that the saddle points of <span class="math notranslate nohighlight">\({\mathcal{L}}\)</span> are optima of the constrainted optimization problem:</p>
<blockquote>
<div><p>Optimize <span class="math notranslate nohighlight">\(f({\theta})\)</span> subject to:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(g_i({\theta}){\leq}0, {\quad} i{\in}\{0{\ldots}n\}\)</span></p>
</div></blockquote>
</div></blockquote>
<p>To find the saddle points we use gradient descent to obtain the global minimum over <span class="math notranslate nohighlight">\({\theta}\)</span> and simultaneous gradient <em>ascent</em> to obtain the global maximum over the multipliers, <span class="math notranslate nohighlight">\({\lambda}\)</span>.</p>
<p>In situations where the contraints are conflicting with the primary objective, vanilla gradient descent can result in oscillations of the solution near the feasible set boundary. These oscillations can be dampened using momentum in gradient descent. We implemented the adam optimizer as part of our gradient descent method, which includes momentum, and found that it mitigates the oscillations in all problems we have tested so far.</p>
</section>
<section id="safety-test">
<h2>Safety Test<a class="headerlink" href="#safety-test" title="Permalink to this headline">¶</a></h2>
<p>The safety test is run on the candidate solution returned by candidate selection. Like candidate selection, the safety test is run inside of the <code class="xref py py-func docutils literal notranslate"><span class="pre">seldonian_algorithm.seldonian_algorithm()</span></code> function. The inputs to the safety test are assembled from the spec object provided to the function. First, a <a class="reference internal" href="_autosummary/seldonian.safety_test.safety_test.SafetyTest.html#seldonian.safety_test.safety_test.SafetyTest" title="seldonian.safety_test.safety_test.SafetyTest"><code class="xref py py-class docutils literal notranslate"><span class="pre">SafetyTest</span></code></a> object is created, then <a class="reference internal" href="_autosummary/seldonian.safety_test.safety_test.SafetyTest.html#seldonian.safety_test.safety_test.SafetyTest.run" title="seldonian.safety_test.safety_test.SafetyTest.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SafetyTest.run()</span></code></a> is called to start the safety test.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Seldonian Engine</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#interface">Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#spec-object">Spec object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dataset-object">Dataset object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-object">Model object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#behavioral-constraints">Behavioral constraints</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#constraint-strings">Constraint strings</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#candidate-selection">Candidate Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#safety-test">Safety Test</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Seldonian Engine documentation</a></li>
      <li>Next: <a href="getting_started.html" title="next chapter">Getting Started</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, University of Massachusetts, Amherst.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/overview.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>